---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout>

</BaseLayout>

<script>
  import { getCurrentLocation } from '../apis/LocationApi';
  import { getCurrentWeather, getForecast } from '../apis/WeatherApi';
  import { convertToTopPageUIModel } from '../utils/TopPageUIModelConverter';

  const locationStatus = document.getElementById('locationStatus');
  const updateLocationStatus = async () => {
    if (!locationStatus) return;
    
    try {
      console.log('Getting location...');
      locationStatus.textContent = 'Getting location...';
      // Naver Throw Error: Fallback to default location
      const data = await getCurrentLocation();

      try {
        console.log('Getting weather data...');
        locationStatus.textContent = 'Getting weather data...';
        const [weatherData, forecastData] = await Promise.all([
          getCurrentWeather(data.latitude, data.longitude),
          getForecast(data.latitude, data.longitude)
        ]);
        const topPageUIModel = convertToTopPageUIModel(weatherData, forecastData, data.city);

        locationStatus.textContent = 'Success see console result';
        console.log('topPageUIModel', topPageUIModel);
      } catch (weatherError) {
        console.error('Weather data fetch error:', weatherError);
        locationStatus.textContent = `Current location: ${data.city} (Weather data unavailable)`;
      }
    } catch (error) {
      console.error('Location fetch error:', error);
      locationStatus.textContent = 'Unable to get location data. Please check your browser permissions and try again.';
    }
  };

  document.addEventListener('DOMContentLoaded', () => {
    updateLocationStatus();
  });
</script>